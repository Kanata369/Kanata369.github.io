<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/k(180x180).png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/k(32x32).png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/k(16x16).png?v=5.1.4">


  <link rel="mask-icon" href="/images/logok.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="课程视频:https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1iW411d7hd?share_source&#x3D;copy_web Lecture02:Bits,Bytes,and Integer浮点数的二进制表示:100010.101&#x3D;1*2^5+1*2^1+1*2^(-1)+1*2^(-3) 4个bit分为一组—&gt;十六进制 x86-64上的数据类型:  char 1字节—8位">
<meta property="og:type" content="article">
<meta property="og:title" content="CSAPP">
<meta property="og:url" content="https://kanata369.github.io/2022/07/02/CSAPP/index.html">
<meta property="og:site_name" content="Kanata&#39;s blog">
<meta property="og:description" content="课程视频:https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1iW411d7hd?share_source&#x3D;copy_web Lecture02:Bits,Bytes,and Integer浮点数的二进制表示:100010.101&#x3D;1*2^5+1*2^1+1*2^(-1)+1*2^(-3) 4个bit分为一组—&gt;十六进制 x86-64上的数据类型:  char 1字节—8位">
<meta property="og:locale">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2356">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2357">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2358">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/屏幕截图(2359">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2360">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2361">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2362">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2363">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2364">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2365">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2366">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2367">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2368">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2369">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2371">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2372">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2373">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2375">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2376">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2377">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2379">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2380">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2382">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2383">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2384">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2386">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2387">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2388">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2389">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2390">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2391">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2392">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2394">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2395">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2396">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2397">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2398">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2399">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2400">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2403">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2404">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2405">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2406">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2409">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2401">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2412">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2413">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2414">
<meta property="article:published_time" content="2022-07-02T02:32:53.000Z">
<meta property="article:modified_time" content="2022-09-05T09:49:23.642Z">
<meta property="article:author" content="Kanata">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2356">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://Kanata369.github.io/2022/07/02/CSAPP/"/>





  <title>CSAPP | Kanata's blog</title>
  








<meta name="generator" content="Hexo 6.1.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Kanata's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://Kanata369.github.io/2022/07/02/CSAPP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Kanata's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">CSAPP</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2022-07-02T10:32:53+08:00">
                2022-07-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E5%AD%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index">
                    <span itemprop="name">大学学习</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i>
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>课程视频:<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1iW411d7hd?share_source=copy_web">https://www.bilibili.com/video/BV1iW411d7hd?share_source=copy_web</a></p>
<h1 id="Lecture02-Bits-Bytes-and-Integer"><a href="#Lecture02-Bits-Bytes-and-Integer" class="headerlink" title="Lecture02:Bits,Bytes,and Integer"></a>Lecture02:Bits,Bytes,and Integer</h1><p>浮点数的二进制表示:100010.101=1*2^5+1*2^1+1*2^(-1)+1*2^(-3)</p>
<p>4个bit分为一组—&gt;十六进制</p>
<p>x86-64上的数据类型:</p>
<ol>
<li>char 1字节—8位</li>
<li>short 2字节—16位</li>
<li>int 4字节—32位</li>
<li>long 8字节—64位</li>
<li>float 4字节—32位</li>
<li>double 8字节—64位</li>
<li>long double 10/16字节(只使用10个字节，当在64位机器上使用时，额外6字节被浪费—保证了一切以16字节对齐)</li>
</ol>
<p>64位机器、32位机器:地址是64位或32位(即pointer的大小)</p>
<p>位移操作(shift)</p>
<p>左移(left shift):将bit-vector向左移动,将溢出位舍弃,在右边填0</p>
<p>右移(right shift):将bit-vector向右移动,将多余位舍弃</p>
<p>signed的逻辑右移(logic shift):在左边填0</p>
<p>signed的算术右移(Arithmetic shift):在左边复制符号位(为什么没有算术左移?左移相当于执行了一次可能会溢出的乘法)</p>
<p>注意:移动&lt;0的数或大于等于数据字节长度的行为,都是UB</p>
<p>二进制到unsigned,signed的转换(T表示two’s complement,即二进制补码形式):</p>
<script type="math/tex; mode=display">B2U(x)=\sum_{i=0}^{w-1}{x_{i}*2^{i} }</script><script type="math/tex; mode=display">B2T(x)=-x_{w-1}*2^{w-1}+\sum_{i=0}^{w-2} {x_{i}*2^{i} }</script><p>即最高位取负数,其他不变,若最高位为1,则一定是负数(最大为-1)</p>
<script type="math/tex; mode=display">UMin=0,UMax=2^{w}-1,TMin=-2^{w-1},TMax=2^{w-1}-1</script><p>|TMin|=TMax+1</p>
<p>UMax=2*TMax+1</p>
<p>B2U,U2B(对同一个bit-vector,建立从signed到unsigned的映射)</p>
<p>注意:在C中,默认常量都是signed,如要使用unsigned需要添加后缀”U”,如0U,4294967259U</p>
<p>当signed,unsigned被混合运算时(如大小比较),signed总被转化成unsigned(bit-vector保持不变,仅仅是转换方式变化)</p>
<p>signed extension(如32位拓展到64位):signed在左边复制符号位(类似算术右移),即从符号位开始的一连串1,可等价于将这串1中,<strong>最低位</strong>作为符号位</p>
<h1 id="Lecture03-Bits-Bytes-and-Integers-cont"><a href="#Lecture03-Bits-Bytes-and-Integers-cont" class="headerlink" title="Lecture03:Bits,Bytes,and Integers cont"></a>Lecture03:Bits,Bytes,and Integers cont</h1><p>Unsigned Addition :相加后无论”多出”的一位是什么,都舍弃掉,可理解为模运算,即<script type="math/tex">UAdd_{w}(u,v)=(u+v)mod {2^{w} }</script></p>
<p>Two’s complement Addition:等价于将两个数都转化为unsigned计算后再转化为signed(即<strong>按位相加</strong>)</p>
<p>正溢出(positive):两个较大正数加在一起使符号位变成1,即得到负数</p>
<p>负溢出(positive):两个较小负数加在一起使符号位变成0,即得到正数</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2356" alt="">.png)</p>
<p>Unsigned Multiplication:相乘后多余位舍弃,可理解为模运算,即<script type="math/tex">UMult_{w}(u,v)=u*v mod{2^{w} }</script></p>
<p>Signed Multiplication:当作<strong>unsigned</strong>相乘后舍弃多余位,剩下的首位作为符号位,如5<em>5=25—&gt;11001—&gt;1001—&gt;-7,若相乘后的数字可以用目前位数表示,则结果正常(注意,这里相乘后的数字指的是<em>*signed相乘结果</em></em>,而不是转化成unsigned后的相乘结果)</p>
<p>注意,负数算术右移时,结果会向负无穷舍入,而不是零(即左侧,事实上这就是二分中通常用&gt;&gt;1的原因),如果想要向零舍入,需要添加一个偏移量(添加偏移量的操作,编译器会在使用<strong>除法</strong>时自动添加,然后在实施<strong>右移</strong>)</p>
<p>??C语言对signed的右移是算术还是逻辑右移没有明确规定,绝大多数情况下是算术右移</p>
<p>移位操作消耗1计算周期,而乘法操作消耗3个计算周期(通过各种硬件优化),除法操作消耗30个计算周期</p>
<p>signed取相反数(x—&gt;-x):将所有位取反,再+1,故Tmin=-Tmin</p>
<hr>
<p>数据是如何存储的:在64位机器中,地址有64位,可以将内存系统理解为一个巨大的char数组,每一个char占据一字节,64位地址能表示的下标从0~2^64,故最多存储2^64字节数据(实际上目前能使用的最大内存地址是47位,对应的内存大小大约是128TB),实际上,只是程序认为它可以使用这么大的空间,当程序运行时,系统会规定其能访问的内存区域,如果程序试图访问其他区域,将报错(即segementation fault)</p>
<p>一般情况下,数据类型的地址取其占有的bytes的最低位地址,如64位地址占据了0000~0007这8个byte,这该地址是0000,类比0008~0015是0008;而32位地址同理,0000~0004是0000,0005~0007是0005(地址表示一般情况下使用十六进制)</p>
<p>字长(Word Size):没有明确规定,当我们提及64位机器时,指的是其pointer/地址大小是64位(尽管只使用了47位)</p>
<p>使用GCC编译时,可以指定它是64位还是32位,会生成两种不同类似的object code,即硬件本身不一定定义字节大小,是硬件和编译器一起决定(64位的代码也可兼容32位机器)</p>
<p>multi-byte word是如何在内存中排序的?</p>
<p>小端序(little endian):最低有效byte拥有最低位地址(x86,IOS,Windows,ARM processors running Android)</p>
<p>大端序(big endian):最低有效byte拥有最高位地址(PPC MAC,Internet)</p>
<p>如15213=3B6D(十六进制)</p>
<p>在小端序中:6D 3B 00 00</p>
<p>在大端序中:00 00 3B 6D</p>
<p>例外:无论是小端序还是大端序,char数组的存储顺序都是相同的,即都符合大端序,’/0’放在最高位</p>
<p>实际上,ARM的硬件配置为既能处理小端序也能处理大端序</p>
<h1 id="Lecture04-Floating-Point"><a href="#Lecture04-Floating-Point" class="headerlink" title="Lecture04:Floating Point"></a>Lecture04:Floating Point</h1><p>小数/分数的二进制表示:<script type="math/tex">\sum_{k=-j}^{i}{b_{i}*2^{k} }</script>(小数点左侧0~i,右侧-1~-j)</p>
<p>如果是分数—&gt;依次减1/2,1/4,1/8判断该位是否为1</p>
<p>如果固定位数,将point左移,则能表示的最大值变小了,精度变大;将point右移,则精度变小,能表示的最大值变小了,故采用floating point,即浮点来表示小数</p>
<hr>
<p>IEEE(电气电子工程师学会) floating point:</p>
<p>形式:<script type="math/tex">(-1)^{s}*M*2^{E}</script></p>
<p>Sign bit 表示了该数是正是负;Significand/Mantissa表示一个介于[1.0,2.0)之间的值;而Exponent表示了该值要乘上2的多少次方</p>
<p>单精度浮点数(32位):s占一位,exp占8位,frac占23位;双精度浮点数(64位):s占一位,exp占11位,frac占52位;80位浮点数(Intel only):s占1位,exp占15位,frac占63位或64位(所以为什么不直接取64位呢?)</p>
<hr>
<p>Normalized values:</p>
<p>exp域(阶码字段)决定了E,但不等于E,同时,exp域不能全为0或全为1.exp域视作一个unsigned number,exp域的值-bias(偏移量,值为<script type="math/tex">2^{k-1}-1</script>)后才是E.(example:exp占8位,则bias为127,exp域本身的范围是1~254,加上偏移量后是-126~127).</p>
<p>注意,为何不用exp域不使用signed number的标准—&gt;便于浮点数之间比较</p>
<p>significand域(尾数域/frac)决定了M,但不等于M,其采用隐含编码法.即假设M=1.xxxxxx始终成立,可以省去一位来表示小数点前的1,所以尾数域全0时尾数最小为1,尾数域全1时尾数最大,极其接近2.0</p>
<hr>
<p>Denormalized values:</p>
<p>来源:当我们想表示0or非常接近0的数时,尾数域隐含的1限制了我们</p>
<p>解决措施:当exp全为0时,其值不是0-bias,而是1-bias.同时,尾数域隐含的1变为0,即0.xxxxxx</p>
<p>example:</p>
<ol>
<li>exp全为0,frac全为0,则此时值为0,但注意有(+0和-0的区别)</li>
<li>exp全为0,frac不全为0,则此时值很接近0(0.xxxxx的-126次方)</li>
</ol>
<hr>
<p>Special values:</p>
<p>当exp全为1时:</p>
<ol>
<li>若frac全为0,则表示一个<script type="math/tex">{\infty}</script>,如<script type="math/tex">1.0/0.0=-1.0/-0.0={+\infty}</script>,<script type="math/tex">1.0/-1.0={-\infty}</script></li>
<li>frac不为0,表示Not-a-Number(NaN),表示无法确定的值,如sqrt(-1),<script type="math/tex">{\infty}-{\infty}</script>,<script type="math/tex">{\infty}*0</script></li>
</ol>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2357" alt="">.png)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2358" alt="">.png)</p>
<p>相关性质:比较浮点数的大小时,除了NaN,都可以将其视作unsigned number比较(即从高到低依次相比):正数总是比负数大;当exp不全为0时,exp域大的数总是比exp域小的数大(最高位是隐含的1);当exp全为0时,尾数域大的总是比尾数域小的数大</p>
<hr>
<p>Floating Point Operations(addition,multiplication)</p>
<p>rounding(舍入):</p>
<ol>
<li>towards zero(向零舍入)</li>
<li>round down(向负无穷舍入,即舍入后的值&lt;=舍入前的值)</li>
<li>round up(向正无穷舍入,即舍入后的值&gt;=舍入前的值)</li>
<li>default:nearest even(向最靠近的值舍入,偶数优先,如1.4-1,1.6-2,1.5-2,2.5-2,-1.5—2)</li>
</ol>
<p>为什么采用IEEE采用nearest even作为默认舍入规则:当给定<strong>足够多</strong>数据时,这些数据有50%的概率增加或减少,故平均值保持不变(可能不够严谨,但至少能说明为什么该规则较优)</p>
<p>而应用到二进制数上:偶数即有效位的最低位是0,而中间值(即’0.5’)是10000….,其他都同理</p>
<hr>
<p>Floating Point Multiplication:</p>
<p>符号位取异或,exp域相加,尾数域相乘</p>
<p>如果尾数域&gt;=2,右移,增加exp</p>
<p>如果exp超出范围,overflow</p>
<p>对尾数域相乘结果进行舍入以对应尾数域精确度</p>
<hr>
<p>Floating Point Addition:</p>
<p>首先对齐小数点(即exp域取二者中较大值),然后相加</p>
<p>若尾数域&gt;=2,右移,增加exp</p>
<p>若尾数域<1,左移k位使其>=1,exp减少k</p>
<p>如果exp超出范围,overflow</p>
<p>对尾数域相加结果进行舍入以对应尾数域精确度</p>
<hr>
<p>注意,浮点数的加法,乘法均不满足结合律,如(1e20+3.14)-1e20=0,(1e20-1e20)+3.14=3.14</p>
<p>(1e20*1e20)*1e-20=inf,1e20*(1e20*1e-20)=1e20</p>
<p>在”自然”条件中,值通常是连续的,即不会相差太大,浮点数的该性质通常不会产生影响.但是在非自然条件中,如金融行业中的计算,需要注意该性质对结果的影响.</p>
<hr>
<p>C语言中的浮点数</p>
<p>当浮点数和int之间发生类型转化时,不能保持bit-vector不变而只改变翻译方式</p>
<p>double/float—&gt;int:</p>
<ol>
<li>截去小数(效果如同向0舍入)</li>
<li>当浮点数的值超出范围或者为NaN时,没有定义,通常情况下会设置为TMin</li>
</ol>
<p>int—&gt;double:</p>
<ol>
<li>如果int的位数小于等于53(double的尾数域长度),值将不会改变</li>
</ol>
<p>int—&gt;float:</p>
<ol>
<li>同理double,若尾数域长度小于int位数,将会发生舍入</li>
</ol>
<h1 id="Lecture05-Machine-Level-Programing-I-Basics"><a href="#Lecture05-Machine-Level-Programing-I-Basics" class="headerlink" title="Lecture05:Machine-Level Programing I:Basics"></a>Lecture05:Machine-Level Programing I:Basics</h1><p>一般说machine program有两种含义,一是计算机实际运行的object code(是一系列代表着实际操作的字节);二是汇编代码(编译器的目标便是将代码转化成汇编代码).二者是一一对应的.</p>
<p>x86机器有两种汇编语言,一种是Intel和Microsoft使用的,一种是Linux使用的(本课程使用).二者参数顺序不同.</p>
<p>本课程采用的是英特尔64位processors(处理器)的指令集</p>
<hr>
<p>英特尔processors的历史:</p>
<p>x86是对英特尔processer的一个口头称呼,因为芯片名字都含有86</p>
<p>x86的特性总是不断进化\重叠,其指令集或许不是最清晰易懂的,却是最uesful的</p>
<p>80年代的RISC(reduced instructions set computer,即精简指令集计算机)和CISC(complex instructions set computer,复杂指令计算机.实际上,CISC是RISC派给以前的处理器起的名,带有贬义色彩,乐)大战</p>
<p>英特尔采用CISC架构 </p>
<hr>
<p>8086:1978年推出,是第一个16位Intel processor,有1MB的内存空间,其一个变种是IBS和DOS的基础</p>
<p>386:1985年推出,也被称作IA32,因为其是第一个32位Intel processor.添加了”flat addressing”,能运行Unix或Lunix</p>
<p>Pentium 4E:2004年推出,也被称作x86-64,因为其是第一个64位Intel processor(其也可运行32位代码,避免了software从32位到64位的长久迭代)(到这一代为止,Intel processor的性能都在逐步提升,但面对着功耗过高的问题,引出了多核processor(可以理解为在一个芯片上塞多个处理器))</p>
<p>Core 2:2006年推出,是第一个multi-core(多核)Intel Processor</p>
<p>Core i7:2008年推出,其拥有4个core</p>
<hr>
<p>Processors有Desktop Model(一般功率更高)和Server Model(Cores一般更多)两种</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/屏幕截图(2359" alt="">.png)</p>
<p>DDR:processor链接到主存储器的方式,即DRAM/动态RAM</p>
<p>PCI是与外部设备的连接</p>
<p>SATA是与不同类型盘的连接</p>
<p>Ethernet(以太网接口)连接到一个网路</p>
<p>这些逻辑单元和处理器一起组成了芯片</p>
<hr>
<p>Advanced Micro Decvices:AMD(Intel的对手,和Intel之间吵过专利,结果是AMD被允许生产x86处理器)</p>
<p>AMD提出了64位英特尔扩展程序</p>
<hr>
<p>2001年,Intel投入大量资金,试图从IA32转变到IA64,在市场上没有成功</p>
<p>而AMD将寄存器变大,只是将东西从32位变成64位,并获得了成功,于是Intel跟随其脚部继续推出x86</p>
<hr>
<p>ARM(Acorn RISC Machine),一家公司推出的自家芯片,然后公司华丽丽的破产了,但是其指令集非常高效且简单,可以设置在芯片上,且可定制</p>
<p>所以ARM现在是一家位于英国剑桥的公司,向其他公司出售使用其设计的许可权利(其比x86机器功耗更低)</p>
<hr>
<p>如前言所说,编译器的目标是将你的code转化成电脑操作的指令,但有些指令更简单,却需要更多硬件,有些指令很繁琐,但不需要什么硬件条件,而如何最好的实现指令集,是硬件研究者的工作</p>
<hr>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2360" alt="">.png)</p>
<p>pc:Program counter,存储下一条指令的地址,在x86-64中被称作”RIP”</p>
<p>register:存储数据(有各自的名字,如%rbx,%rdx等等)</p>
<p>condition code:存储操作的状态信息,在branching(“分支”)中使用</p>
<p>Memory:可以视作一个巨大的字节数组,实际上是操作系统和硬件协调产生的一种”虚拟内存”,每个软件都有自己独立的字节数组,而在物理意义上,所有软件都共享这些字节数组(cache指的是多次访问同一位置的内存总是更快,但注意,在指令层面,你无法直接操作cache)</p>
<hr>
<p>将C 转变成object code:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2361" alt="">.png)</p>
<p>第一步是将C代码变成汇编代码(gcc -Og -S,-Og是对编译器进行什么优化的规范,O是指Optimize,如果不加,将不会进行任何优化,;-S意思是Stop,只做第一部分,即将C代码变成汇编代码)</p>
<p>第二步是通过汇编程序(Assembler)运行它,将文本形式的代码转化成字节形式</p>
<p>第三步是通过链接器(Linker),将不同的文件融合在一起</p>
<p>(你的各个代码文件和库代码)</p>
<p>实际上,当真正开始运行这个程序上时,有些库是在首次启动时动态导入</p>
<hr>
<p>1.将C转化成Assembly(汇编代码)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2362" alt="">.png)</p>
<p>pushq:将某个数据压入栈中</p>
<p>movq:将某个数据移动位置</p>
<p>call:调用某个procedure(操作序列)</p>
<p>ret:从一个特定的函数返回</p>
<p>汇编代码中的数据类型:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2363" alt="">.png)</p>
<p>Integer类型:存储整数(不区分signed,unsigned,C中的pointer等数据类型也以该形式存储)</p>
<p>Floating point类型:以不同的方式处理,使用不同的寄存器组</p>
<p>Code:定义了一系列操作的字节序列</p>
<p>结构体等数据类型,都不存在于机器代码中,都由编译器来定义</p>
<hr>
<p>2.将汇编代码变成object code</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2364" alt="">.png)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2365" alt="">.png)</p>
<p>一些指令可能只有1byte,但也有些指令有15bytes(不同指令所代表byte长度不一定)</p>
<p>变量的所有名称,在汇编代码,机器代码级别完全丢失(变成了寄存器和内存中的某个位置)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2366" alt="">.png)</p>
<p>disassembler/反汇编(顾名思义,将object code逆推成汇编代码)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2367" alt="">.png)</p>
<p>gdb:强大的debugger,可以在存在source code的情况下进行调试,不存在source code时,也可进行调试,其也具有反汇编功能(disassemble xxxx)</p>
<p>x/14xb sumstore—显示从sumstore地址开始的14个十六进制byte</p>
<hr>
<p>更多的汇编基础知识:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2368" alt="">.png)</p>
<p>注意:如果你使用%r版本,使用的是64位register;如果你使用%e版本,使用的是32位register(实际上,%e版本只是使用了%r版本的低32位,同理,8位,16位都可取到)</p>
<p>rsp是特殊的寄存器,被称为栈指针(stack point)</p>
<p>左半部分寄存器(除rsp)的命名来自其原始用途,现在这些名字只是历史遗留问题,在大多数情况下,他们都可用于保存数据</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2369" alt="">.png)</p>
<p>注意,从IA32到64位处理器,寄存器数量增加了一倍</p>
<hr>
<p>movq operation:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2371" alt="">.png)</p>
<p>注意,不能将内存中的数据直接移动到内存中的另一个地方,需要两次操作(Mem-Reg,Reg-Mem)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2372" alt="">.png)</p>
<p>(%xxx)表示对该寄存器所存储的地址解引用</p>
<p>D(%xxx),D是一个数字,表示对该寄存器所存储的地址加一个偏移量后解引用</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2373" alt="">.png)</p>
<p>swap函数示例</p>
<p>对地址解引用的更多操作:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2375" alt="">.png)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2376" alt="">.png)</p>
<p>leaq(load effective address):地址操作</p>
<p>有些乘法操作可以转化成leaq,如*12—&gt;*3再*4</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2377" alt="">.png)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2379" alt="">.png)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2380" alt="">.png)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2382" alt="">.png)</p>
<h1 id="Lecture06-Machine-Level-Programing-II-Control"><a href="#Lecture06-Machine-Level-Programing-II-Control" class="headerlink" title="Lecture06:Machine-Level Programing II:Control"></a>Lecture06:Machine-Level Programing II:Control</h1><p>Condition codes:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2383" alt="">.png)%rip:指令指针(instruction pointer,在IA32中中叫%eip),包含正在执行指令的地址,无法通过<strong>正常方式</strong>操作(可通过技巧获取它的值)</p>
<p>condition codes一共有8个,图中只展示了4个,都只有1bit</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2384" alt="">.png)</p>
<p>CF:在二进制加法时,表示是否进位(翻译为溢出更恰当?)</p>
<p>ZF:当计算结果为0时被置位</p>
<p>SF:计算结果最高位为1时(signed)被置位</p>
<p>OF:当signed计算溢出时被置位(包括加,乘?)</p>
<p>注意,lea不会操作这4个condition code</p>
<p>专门操作condition code的指令:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2386" alt="">.png)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2387" alt="">.png)</p>
<p>获取condition code的手段:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2388" alt="">.png)</p>
<p>setX根据condition code的状态,将目标寄存器的低位,置1或置0,以此来知道最近的指令做了什么</p>
<p>sete,setne表示上次指令的结果是相等或为零</p>
<p>sets,setns表示上次指令的结果的正负性(没有考虑溢出)</p>
<p>setg,setge表示上次指令的结果是大于(大于或等于),这里用了~(SF^OF)表示大于或等于,即考虑了正溢出和负溢出,保证了比大小不会因为溢出出错</p>
<p>setl,setle同理</p>
<p>setb表示上次指令结果是否溢出(unsigned)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2389" alt="">.png)</p>
<p>%xxl表示寄存器的最后一位(l—low)</p>
<p>setX示例:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2390" alt="">.png)</p>
<p>PS:x86-64的小特性:当你操作32位寄存器时,会将寄存器的其余32位置为0.</p>
<p>而byte(如short)操作不动其他位(更低位也如此)</p>
<hr>
<p>Conditional branches:</p>
<p>if和else</p>
<p>传统的实现方法:jump instruction</p>
<p>unconditional jump(无条件跳跃)</p>
<p>conditonal jump(有条件跳跃)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2391" alt="">.png)</p>
<p>示例:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2392" alt="">.png)</p>
<p>.XXX:label,在object code中并不存在(代表了指令的地址?)</p>
<hr>
<p>优化:Conditional Moves(类似于先将if的结果和else的结果都算出来,根据条件值判断使用哪个)</p>
<p>先猜测条件结果(大部分情况下都能猜对),并直接开始计算</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2394" alt="">.png)</p>
<p>可以类比工厂的工作流水线,可以同一时间处理多条指令,而不是卡在条件指令,使之更有效率</p>
<p>示例:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2395" alt="">.png)</p>
<p>注意,conditional move仅在分支计算都很简单的时候能提高效率,在某些情况下甚至有风险(如解引用NULL指针),有时计算结果影响条件判断</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2396" alt="">.png)</p>
<hr>
<p>loops:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2397" alt="">.png)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2398" alt="">.png)</p>
<p>dowhile循环的实现</p>
<hr>
<p>-Og级别的while:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2399" alt="">.png)</p>
<p>-O1级别的:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2400" alt="">.png)</p>
<hr>
<p>for循环</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2403" alt="">.png)</p>
<p>类似while循环</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2404" alt="">.png)</p>
<p>采用O1优化时,会删除初始化之后的一个test(因为一定对)</p>
<hr>
<p>switch:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2405" alt="">.png)</p>
<p>switch会生成一个类似于数组的jump table,以快速定位提高效率</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2406" alt="">.png)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2409" alt="">.png)</p>
<p>注意,从0到x的最大值均有其标签(如果出现负数,会添加一个bias使下标从0开始)</p>
<p>若是x的范围过大且相对稀疏(如x为0和1000000,会使用二分优化成if else)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2401" alt="">.png)</p>
<p>break代码块:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2412" alt="">.png)</p>
<p>注意,switch后即为return w,故将ret写在代码块内</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2413" alt="">.png)</p>
<p><img src="https://cdn.jsdelivr.net/gh/Kanata369/blogimage@main/img/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE(2414" alt="">.png)</p>
<p>只有case3中的指令需要w初始化,故将w初始化放在case3中.</p>
<p>case2fall-through到case3中,故在初始化后添加merge标签供case2跳转</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2022/06/30/CF1698E/" rel="next" title="CF1698E">
                <i class="fa fa-chevron-left"></i> CF1698E
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2022/07/05/BUPT-2022-summer-1/" rel="prev" title="BUPT_2022_summer_1">
                BUPT_2022_summer_1 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1496089152&auto=0&height=66"></iframe>
      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name"></p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/">
              
                  <span class="site-state-item-count">58</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://www.zhihu.com/people/dyg-55" target="_blank" title="Zhihu">
                      
                        <i class="fa fa-fw fa-globe"></i>Zhihu</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友链
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://tangdouer.cn" title="糖豆儿" target="_blank">糖豆儿</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Lecture02-Bits-Bytes-and-Integer"><span class="nav-number">1.</span> <span class="nav-text">Lecture02:Bits,Bytes,and Integer</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lecture03-Bits-Bytes-and-Integers-cont"><span class="nav-number">2.</span> <span class="nav-text">Lecture03:Bits,Bytes,and Integers cont</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lecture04-Floating-Point"><span class="nav-number">3.</span> <span class="nav-text">Lecture04:Floating Point</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lecture05-Machine-Level-Programing-I-Basics"><span class="nav-number">4.</span> <span class="nav-text">Lecture05:Machine-Level Programing I:Basics</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Lecture06-Machine-Level-Programing-II-Control"><span class="nav-number">5.</span> <span class="nav-text">Lecture06:Machine-Level Programing II:Control</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kanata</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a></div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  <script type="text/x-mathjax-config">
MathJax.Hub.Config({
	//下面的HTML-CSS和SVG用于在小屏幕上，数学公式可以自动换行，我测试过后发现无效，但是貌似有人可以。
	"HTML-CSS": { 
		linebreaks: { 
			automatic: true 
		} 
	},SVG: {
		linebreaks: { 
			automatic: true 
		}
	},menuSettings: {
		zoom: "None"
	},
	showMathMenu: false,
	jax: ["input/TeX","output/CommonHTML"],
	extensions: ["tex2jax.js"],
	TeX: {
		extensions: ["AMSmath.js","AMSsymbols.js"],
		equationNumbers: {
			autoNumber: "AMS"
		}
	},tex2jax: {
		inlineMath: [["\\(", "\\)"]],
		displayMath: [["\\[", "\\]"]]
	}
});
</script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":true,"model":{"scale":1.5,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/assets/miku.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false});</script></body>
</html>
